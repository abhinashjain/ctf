## Task: 
Login as Admin to view the flag in admin.php                                                                                                                                                                                     
                                                                                                                                                                                                                                           
### SignUp Manager                                                                                                                                                                                                                          
                                                                                                                                                                                                                                           
SignUp manager is a simple and easy to use script which allows new users to signup and login to a private page. All users are stored in a file so need for a complicated database setup.                                                   
                                                                                                                                                                                                                                           
#### How to Install                                                                                                                                                                                                                         
                                                                                                                                                                                                                                           
1) Create a directory that you wish SignUp Manager to be installed into                                                                                                                                                                    
                                                                                                                                                                                                                                           
2) Move signupmanager.zip into the new directory and unzip it.                                                                                                                                                                             
                                                                                                                                                                                                                                           
3) For security move users.txt into a directory that cannot be read from website visitors                                                                                                                                                  
                                                                                                                                                                                                                                           
4) Update index.php with the location of your users.txt file                                                                                                                                                                               
                                                                                                                                                                                                                                           
5) Edit the user and admin php files to display your hidden content                                                                                                                                                                        
                                                                                                                                                                                                                                           
6) You can make anyone an admin by changing the last character in the users.txt file to a Y                                                                                                                                                
                                                                                                                                                                                                                                           
7) Default login is admin / password                                                                                                                                                                                                       
                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                           
## Solution:                                                                                                                                                                                                                                 
Follow the above steps to have a local setup.                                                                                                                                                                                         
                                                                                                                                                                                                                                           
From the source code, we know that we know that for a given user the cookie will always be constant, and we need two things to log in as admin, a valid cookie, and 'Y' as the last character against a username in users.txt file.          
To achieve this we have the following 3 options:                                                                                                                                                                                           
* Search and determine if we have read access to users.txt: If we can determine the directory where the users.txt file is stored and if we can read that file then we can read the admin's cookie that we can use to get access to the admin.php page. We tried using tools like ffuf, gobuster, etc. but were not successful in knowing the location of the users.txt file.                                                                                                          
* Bruteforce cookie value: Because the cookie value is 128-bit long, it's almost impossible to brute-force it. The other reason to discard this option is that we are not even sure if there exists any admin user in the users.txt file.   
* Controlling the 113th character while user registration: The 113th character is the one that decides whether the logged-in user is an admin or not. This 113th character is not directly controlled or taken from the user input. But, we know this entry is done in the users.txt file at the time of user registration. Therefore we can examine how the registration parameters are handled and if there's any check-in place to prevent the user from sending malicious input at the time of registration.
     * username, first name, and last name: Length is restricted to (3,15]. None of these are of any use to us.
     * password: User-supplied password is stored as md5 hash therefore, its length will always be 32 hex characters long. Hence, it's of no use to us. 
     * age: The following checks are performed on this parameter:
          * Use of [is_numeric](https://www.php.net/manual/en/function.is-numeric.php#114285) function to enforce the provided value should either be a number or numeric string. Because the numeric string is also accepted we can pass the age as '1e3'.
          * Use of strlen() to validate the length should never be greater than 3 characters. Not possible to bypass this check.
          * If the above two conditions are passed then the value is further pass through the [intval](https://www.php.net/manual/en/function.intval.php#refsect1-function.intval-examples) function. i.e. intval(1e3) becomes 1000. With this we can make the value of the 'age' variable as more than 3 characters and use it to overwrite the subsequent or 113th character.
                     

What further helps in overwriting is the usage of [str_pad](https://www.php.net/manual/en/function.str-pad.php#refsect1-function.str-pad-examples) as ```str_pad($age, 3, "#")``` in the ```adduser()``` function that evaluate ```str_pad('1000', 3, "#")``` to ```1000``` i.e. of length 4.

Now, we can overwrite the 113th character to 'Y' and push the 'N' to 114th place by sending the following details at the time of registration: 
username=YYYYYYYYYYYYYYY, password=YYYYYYYYYYYYYYY, firstname=YYYYYYYYYYYYYYY, lastname=YYYYYYYYYYYYYYY, age=1e3.

After registration when a user logs in as username=YYYYYYYYYYYYYYY and password=YYYYYYYYYYYYYYY it will land to the admin.php that contains the flag.

